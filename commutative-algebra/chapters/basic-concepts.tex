\chapter{基本知识}

\section{环与理想}

一个\emph{环}指的是一个配备结合乘法的加性交换群.
在不加说明的情况下, 本笔记中提到的环一般要求其乘法交换且有乘法单位元.

\subsection{根式理想}

假设给定一个环 \( A \).
称 \( f \in A \) \emph{幂零}, 如果存在 \( r \geq 1 \) 使得 \( f^r = 0 \).
称 \( A \) \emph{约化的}, 如果 \( A \) 有没有非零的幂零元.
给定 \( A \) 的任意理想 \( \mathfrak{a} \), 其对应了 \( A \) 的一个理想
\begin{equation}
  \left\lbrace f \in A : f^r \in \mathfrak{a}, \text{对某个} r \geq 1
  \text{成立} \right\rbrace.
  \label{equation-radical-ideal}
\end{equation}
称由\eqref{equation-radical-ideal}定义的理想为 \( \mathfrak{a} \) 的根,
将其记作 \( \operatorname{rad}(\mathfrak{a}) \).
特别地, \( (0) \) 的根称为 \( A \) 的\emph{幂零根}, 记作\(
\operatorname{nil}(A) \).
此外, 如果 \( \operatorname{rad}(\mathfrak{a}) = \mathfrak{a} \), 那么称 \(
\mathfrak{a} \) 是 \emph{根式的}.

\begin{proposition}
  假设 \( \mathfrak{a} \) 是环 \( A \) 的一个理想.
  \begin{enumerate}
    \item \( \operatorname{rad}(A) \) 亦是 \( A \) 的一个理想.
    \item \( \operatorname{rad}(\operatorname{rad}(\mathfrak{a})) =
      \operatorname{rad}(\mathfrak{a}) \).
  \end{enumerate}
\end{proposition}

\subsection{素理想}

\paragraph{乘性子集}
环 \( A \) 的 \emph{乘性子集} 是一个子集 \( S \) 满足如下性质
\[
  1 \in S,\quad a, b \in S \implies ab \in S.
\]

\begin{proposition}
  \label{proposition-prime-not-intersect-multiplicative-set}
  假设 \( S \) 是一个环 \( A \) 的子集, \( \mathfrak{a} \) 是 \( A \) 的不交于
  \( S \) 一个理想.  \( A \) 中包含 \( \mathfrak{a} \) 但不交于 \( S \)
  的理想集族 \( \Sigma \) 有一个极大元, 如果 \( S \) 是乘性子集,
  那么每个这样的极大元都是素的.
\end{proposition}
\begin{proof}
  \( \Sigma \) 的每个上升链 \( \mathfrak{a}_1 \subseteq \mathfrak{a}_2 \subseteq
  \cdots \) 都有上界 \( \sum \mathfrak{a}_i \), 由
  \href{https://en.wikipedia.org/wiki/Zorn%27s_lemma}{Zorn 引理}, \( \Sigma \)
  有一个极大元 \( \mathfrak{c} \).
  现在说明 \( \mathfrak{c} \) 是一个素理想.
  假设不然, 如果 \( b b' \in \mathfrak{c} \), 且 \( b, b' \notin \mathfrak{c}
  \), 那么 \( \mathfrak{c} + (b) \) 和 \( \mathfrak{c} + (b') \) 真包含 \(
  \mathfrak{c} \), 因此它们不落于 \( \Sigma \) 中.
  因此 \( \mathfrak{c} + (b) \) 和 \( \mathfrak{c} + (b') \) 各包含 \( S \)
  中的一个元素, 我们分别记其为
  \[
    f = c + ab,\quad c \in \mathfrak{c},\quad a' \in A \text{ 以及 } f' = c' +
    a'b,\quad c' \in \mathfrak{c},\quad a' \in A
  \]
  因此
  \[
    f f' = c c' + abc' + a'b'c + aa'bb' \in \mathfrak{c},
  \]
  这与 \( f f' \in S \) 矛盾.
\end{proof}
\begin{remark}
  \label{remark-maximal-element-prime}
  这种证明理想集中极大元素的方法后面还会遇到若干次.
\end{remark}

\begin{proposition}
  \label{proposition-radical-as-prime-intersection}
  给定 \( A \) 的一个理想 \( \mathfrak{a} \), 那么所有包含 \( \mathfrak{a} \)
  的素理想的交即\( \mathfrak{a} \) 的根式理想, 也就是
  \[
    \operatorname{rad}(\mathfrak{a}) = \bigcap_{\mathfrak{p}\supseteq a}
    \mathfrak{p}.
  \]
  特别地, \( \operatorname{rad}(0) = \bigcap \mathfrak{p} \).
\end{proposition}
\begin{proof}
  \( \operatorname{rad}(\mathfrak{a}) \supset \bigcap_{\mathfrak{p}\supseteq a}
  \mathfrak{p} \).
  如果 \( x \notin \operatorname{rad} \mathfrak{a} \), 也就是乘性子集 \(
  \left\lbrace 1, x, x^2, \ldots \right\rbrace \not\subset \mathfrak{a} \),
  那么由\cref{proposition-prime-not-intersect-multiplicative-set}, 总存在素理想
  \(  \mathfrak{p} \), 使得 \( x \notin \mathfrak{p} \), 故 \( x \notin \bigcap
  \mathfrak{p} \).
\end{proof}

\paragraph{素避引理}

\begin{proposition}[素避]
  假设 \( \mathfrak{p}_1, \ldots, \mathfrak{p}_r, r \geq 1 \) 为 \( A \) 的理想,
  其中 \( \mathfrak{p}_2, \ldots, \mathfrak{p}_r \) 为素理想. 如果理想 \(
  \mathfrak{a} \) 不包含在任何一个 \( \mathfrak{p}_i \), 那么 \( \mathfrak{a} \)
  不包含在 \( \mathfrak{p}_i \) 的并中.
\end{proposition}
\begin{proof}
  对 \( r \) 应用归纳假设.
  \( r = 1 \) 时结论显然.
  假设 \( r > 1 \) 且 \( \mathfrak{a} \subseteq \bigcup_{1 \leq j \leq r}
  \mathfrak{p}_j \), 但对任意 \( i \), \( \mathfrak{a} \not\subseteq \bigcup_{j
  \neq i}\mathfrak{p}_j \).
  由假设知道,
  存在 \( a_i \in \mathfrak{a} \setminus \bigcup_{j \neq i} \mathfrak{p}_j \),
  那么 \( a_i \in \mathfrak{p}_i \). 考察
  \[
    a = a_1 \cdots a_{r - 1} + a_r \in \mathfrak{a}.
  \]
  因为 \( \mathfrak{p}_r \) 素, \( a_1 \cdots a_{r - 1} \notin \mathfrak{p}_r
  \). 而 \( a_{r} \in \mathfrak{p}_r \), 故 \( a \notin \mathfrak{p}_r \).
  对 \( i \leq r - 1 \), 则 \( a_1 \cdots a_{r - 1} \in \mathfrak{p}_{i} \), 但
  \( a_r \in \mathfrak{p}_i \), 从而 \( a \notin \mathfrak{p}_i \). 这与 \( a
  \subseteq \cup_{1 \leq j \leq r} \mathfrak{p}_j \) 矛盾.
  因此 \( \mathfrak{a} \subseteq \cup_{j \neq i} \mathfrak{p}_j \) 对某个 \( i
  \) 成立, 应用归纳假设即可.
\end{proof}

\subsection{极大理想与 Jacobson 根}

环 \( A \) 的 \emph{Jacobson 根} 是 \( A \) 所有极大理想的交
\[
  \mathfrak{J} = \bigcap \left\lbrace \mathfrak{m}: \mathfrak{m} \text{ 为 } A
  \text{的极大理想} \right\rbrace.
\]
如果 \( A \) 只有一个极大理想, 那么环 \( A \) 称为是 \emph{局部} 的

\begin{proposition}
  \label{proposition-Jacobson-root-iff-condition}
  假设 \( A \) 的 Jacobson 根为 \( \mathfrak{J} \), 那么 \( c \in \mathfrak{J}
  \) 当且仅当对所有 \( a \in A \), \( 1 - ac \) 是单位.
\end{proposition}
\begin{proof}
  给定 \( c \in A \).
  \( c \notin \mathfrak{J} \iff \) 存在 \( A \) 的极大理想 \( \mathfrak{m} \)
  使得 \( c \notin \mathfrak{m} \iff \) 存在极大理想 \( \mathfrak{m} \) 以及 \(
  a \in A, m \in \mathfrak{m} \) 使得 \( ac = 1 + m \), 也就是 \( 1 - ac \)
  并非单位.
\end{proof}

\paragraph{Nakayama引理}

\begin{theorem}[Nakayama引理]
  \label{theorem-Nakayama-lemma}
  假设 \( A \) 是一个环, \( \mathfrak{a} \) 是 \( A \) 的理想, \( M \) 是一个 \(
  A\)-模. 如果 \( \mathfrak{a} \) 包含于所有 \( A \) 的极大理想中, 且 \( M \)
  有限生成, 那么
  \begin{enumerate}
    \item 如果 \( M = \mathfrak{a} M \), 那么 \( M = 0 \).
    \item 如果 \( N \) 是 \( M \) 的子模, 使得 \( M = N + \mathfrak{a} M \),
      那么 \( M = N \).
  \end{enumerate}
\end{theorem}
\begin{proof}
  (1) 如果 \( M \neq 0 \), 由有限生成性可以取一族 \( M \) 的极小生成元 \(
  \left\lbrace e_1, \ldots, e_n \right\rbrace, n \geq 1 \).
  记
  \[
    e_1 = a_1 e_1 + \cdots + a_n e_n,\quad a_i \in \mathfrak{a}.
  \]
  那么
  \[
    (1 - a_1) e_1 = a_2 e_2 + \cdots + a_n e_n.
  \]
  \( \mathfrak{a} \) 包含于 \( A \) 的 Jacobson 根中, 从而 \( 1 - a_1 \) 可逆.
  因此 \( e_2, \ldots, e_n \) 生成 \( M_2 \), 与选取矛盾.
  立刻得到结果.
\end{proof}

\section{环态射, 理想扩张与收缩}

\subsection{中国剩余定理}

\( A \) 的两个理想 \( \mathfrak{a} \) 和 \( \mathfrak{b} \) 是 \emph{互素} 的,
如果 \( \mathfrak{a} + \mathfrak{b} = A \).
\begin{proposition}
  如果 \( \mathfrak{a}_1,\ldots, \mathfrak{a}_n \) 互素, 那么 \( \bigcap
  \mathfrak{a}_i = \prod \mathfrak{a}_i \).
\end{proposition}
\begin{proof}
  \( \bigcap \mathfrak{a}_i \subset \prod \mathfrak{a}_i \).
  这里只证明 \( n = 2 \) 的情况, 一般情况由归纳法保证.
  由假设可以找到 \( a_1 \in \mathfrak{a}_1 \) 以及 \( a_2 \in \mathfrak{a}_2 \)
  使得 \( a_1 + a_2 = 1 \). 如果 \( a \in \mathfrak{a}_1 \cap \mathfrak{a}_2 \),
  那么 \( a = (a_1 + a_2)a \in \mathfrak{a}_1 \mathfrak{a}_2 \).
\end{proof}

\begin{theorem}[中国剩余定理]
  假设 \( \mathfrak{a}_1, \ldots, \mathfrak{a}_n \) 是环 \( A \) 的理想. 并且在
  \( i \neq j \) 时,  \( \mathfrak{a}_i \) 和 \( \mathfrak{a}_j \) 互素,
  那么映射
  \[
    A \to A / \mathfrak{a}_1 \times \cdots \times A / \mathfrak{a}_n,\quad a
    \mapsto (\ldots, a + \mathfrak{a}_i, \ldots)
  \]
  是满射, 且其核为 \( \prod \mathfrak{a}_i = \bigcap \mathfrak{a}_i \).
\end{theorem}
\begin{proof}
  对 \( n \) 做归纳假设.
  \( n = 2 \) 时.
  因为 \( \mathfrak{a}_1 + \mathfrak{a}_2 = A \), 存在 \( a_i \in \mathfrak{a}_i
  \) 使得 \( a_1 + a_2 = 1 \).
  对任意 \( x_1, x_2 \in A \), \( a_1 x_2 + a_2 x_1 \) 映射到 \( (x_1
  \mod{\mathfrak{a}_1}, x_2 \mod{\mathfrak{a}_2}) \), 所以此映射是满射.
  其核显然是 \( \mathfrak{a}_1 \cap \mathfrak{a}_2 \).

  现假设 \( n > 2 \), 对于 \( i \geq 2 \), 存在 \( a_i \in \mathfrak{a}_1 \)
  以及 \( b_i \in \mathfrak{a}_i \) 使得
  \[
    a_i + b_i = 1.
  \]
  积 \( \prod_{i \geq 2}(a_i + b_i) = 1 \) 落于 \( \mathfrak{a}_1 +
  \mathfrak{a}_2 \cdots \mathfrak{a}_n \) 中, 换句话说
  \[
    \mathfrak{a}_1 + \mathfrak{a}_2\cdots \mathfrak{a}_n = A.
  \]
  因此,
  \begin{align*}
    A / \mathfrak{a}_1 \cdots \mathfrak{a}_n &= A / \mathfrak{a}_1 \cdot
    (\mathfrak{a}_2 \cdots \mathfrak{a}_n)\\ &\simeq A / \mathfrak{a}_1 \times A
    / \mathfrak{a}_2 \cdots \mathfrak{a}_n\\ &\simeq A/ \mathfrak{a}_1 \times A
    / \mathfrak{a}_2 \times \cdots \times A / \mathfrak{a}_n,
  \end{align*}
  其中, 最后一个同构由归纳法保证.
\end{proof}


\subsection{理想的扩张与收缩}

假设 \( \varphi: A \to B \) 是一个环同态.
\begin{itemize}
  \item 对 \( B \) 的理想 \( \mathfrak{b} \), \( \varphi^{-1}(\mathfrak{b}) \)
    是\( A \) 的理想, 称为 \( \mathfrak{b} \) 在 \( A \) 上的\emph{收缩},
    记作 \( \mathfrak{b}^{c} \).
  \item 对于 \( A \) 的理想 \( \mathfrak{a} \), \( B \) 中由 \(
    \varphi(\mathfrak{a}) \) 生成的理想, 称为 \( \mathfrak{a} \) 在 \( B \) 中的
    \emph{扩张}, 记作 \( \mathfrak{a}^{e} \).
\end{itemize}
特别地, 如果 \( \varphi \) 满, 那么 \( \varphi(\mathfrak{a}) = \mathfrak{a}^e \);
如果 \( A \) 是 \( B \) 的子环, 那么 \( \mathfrak{b}^{c} = \mathfrak{b} \cap A
\).

\begin{proposition}
  假设\( \mathfrak{a}, \mathfrak{a}' \) 为 \( A \) 的理想, \( \mathfrak{b},
  \mathfrak{b}' \) 为 \( B \) 的理想
  \begin{enumerate}
    \item 我们有下面关系
      \[
        (\mathfrak{a} + \mathfrak{a}')^{e} = \mathfrak{a}^e +
        \mathfrak{a}'^e,\quad (\mathfrak{a} \mathfrak{a}')^e = \mathfrak{a}^e
        \mathfrak{a}'^{e},\quad (\mathfrak{b} \cap \mathfrak{b}')^c =
        \mathfrak{b}^c \cap \mathfrak{b}'^c,\quad
        \operatorname{rad}(\mathfrak{b})^c = \operatorname{rad}(\mathfrak{b}^c).
      \]
    \item \( \mathfrak{a} \subseteq \mathfrak{a}^{ec} \) 且 \( \mathfrak{b}^{ce}
      \subseteq \mathfrak{b} \). 特别地, \( \mathfrak{a}^{e} \subseteq
      \mathfrak{a}^{ece} \) 以及 \( \mathfrak{b}^{cec} = \mathfrak{b}^c \),
      从而我们有双射
      \[
        \left\lbrace \mathfrak{b}^c \subseteq A: \mathfrak{b} \text{为}B
        \text{的理想} \right\rbrace \xleftrightarrow[\mathfrak{b}^c \mapsfrom
        \mathfrak{b}]{\mathfrak{a} \mapsto \mathfrak{a}^e} \left\lbrace
        \mathfrak{a}^e \subseteq B: \mathfrak{a} \text{是} A \text{中的理想}
        \right\rbrace
      \]
  \end{enumerate}
\end{proposition}

\begin{proposition}
  \label{proposition-prime-as-contraction-iff-homomorphism-condition}
  \( A \) 的素理想 \( \mathfrak{p} \)
  是 \( B \) 某个素理想的收缩当且仅当 \( \mathfrak{p} = \mathfrak{p}^{ec} \).
\end{proposition}
\begin{proof}
  \( \impliedby \) 假设 \( S = A \setminus \mathfrak{p} \), \( s \in S \).
  如果 \( \varphi(s) \in \mathfrak{p}^e \), 那么 \( s \in \mathfrak{p}^{ec} =
  \mathfrak{p} \), 与 \( s \) 定义矛盾, 因此 \( \varphi(S) \cap \mathfrak{p}^e =
  \varnothing \).
  由\cref{proposition-prime-not-intersect-multiplicative-set}, 存在 \(
  B \) 的一个素理想 \( \mathfrak{q} \) 包含 \( \mathfrak{p}^e \) 且不交于 \(
  \varphi(S) \).
  结合 \( S \) 的构造 \( \mathfrak{q}^e = \mathfrak{p} \).
\end{proof}

\section{多项式环}

\begin{proposition}
  \label{proposition-monic-polynomial-division-algorithm}
  假设 \( f, g \in A[X] \), 其中 \( g \) 是首一多项式, 那么存在 \( q, r \in A[X]
  \) 使得 \( f = gq + r \), 且要么 \( \deg r < \deg g \) 要么 \( \deg r = 0 \).
  特别地, 如果 \( \alpha \in A \) 是 \( f \in A[X] \) 的一个根, 那么 \( X -
  \alpha \mid f \).
\end{proposition}

\begin{proposition}
  \label{proposition-splitting-polynomial-ring}
  假设 \( A \) 是一个环, \( B \) 是一个 \( A \)-代数, \( f \in B[T] \)
  是一个首一多项式, 那么
  \begin{enumerate}
    \item 存在一个包含 \( B \) 的环 \( B' \) 使得 \( f \) 在 \( B'[T] \)
      上可以分解为一次多项式的积.
    \item \( f \) 首一因子的系数是 \( f \) 一些根的代数组合.
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 对 \( n = \deg f \) 做归纳, 只需对 \( n > 1 \) 的情况证明.
  设 \( B_1 = B[T] / (f) \).
  因为 \( f \) 首一, 对任意 \( g \in B[T] \), \( \deg fg = \deg f + \deg g \),
  也就是 \( (f) \cap B = 0 \).
  因此, 同态 \( B \to B_1 \) 单, 也就是说 \( B[X] \to B_1[X] \) 单, \(
  f(X) \) 可视为多项式环 \( B_1[X] \) 中有一个根 \( b = X + (f) \) 的元素.
  因此由\cref{proposition-monic-polynomial-division-algorithm} \( f \) 可以写为
  \( f = (X - b) f_1 \), 其中 \( f_1 \in b_1[X] \) 首一且 \( \deg f_1 < \deg f
  \).
  对 \( f_1 \) 应用归纳假设, 使得 \( f_1 \) 分裂的 \( B_1 \)-代数 \( B' \) 存在,
  其作为 \( A \)-代数使得 \( f \) 分裂.
\end{proof}

\section{局部化}

\subsection{分式环}

假设 \( S \) 是环 \( A \) 的一个乘性子集. 定义 \( A \times S \) 的一个关系
\[
  (a, s) \sim (b, t) \iff \text{存在} u \in S, \text{使得} u(at - bs) = 0.
\]
可以验证, 这是一个等价关系, 将其中代表元 \( (a, s) \) 记作 \(
\frac{a}{s} \), 那么我们得到了一个环
\[
  S^{-1}A = \left\lbrace \frac{a}{s}: a \in A, s \in S \right\rbrace
\]
以及一个环同态 \( i_S: A \to S^{-1} A, a \mapsto \frac{a}{1} \), 其核为
\[
  \left\lbrace a \in A: \text{存在} s \in S, \text{使得} sa = 0 \right\rbrace.
\]
\begin{remark}
  \label{remark-fraction-ring}
  \begin{enumerate}
    \item \( S \) 没有零除子当且仅当 \( i_S \) 就是单射
    \item 如果 \( 0 \in S \), 那么 \( S^{-1} A = 0 \).
  \end{enumerate}
\end{remark}
\begin{proposition}
  \label{proposition-universal-property-localization}
  局部化 \( (S^{-1}A, i_S) \) 具有下述泛性质: 每个 \( S \) 中的元素映到 \(
  S^{-1} A \) 中的单位, 并且每个将 \( S \) 映到单位的环同态 \( \alpha: A \to B
  \) 能通过 \( i_S \) 唯一分解.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJBIl0sWzEsMCwiU157LTF9QSJdLFsxLDEsIkIiXSxbMCwyLCJcXGFscGhhIiwyXSxbMSwyLCJcXGV4aXN0cyAhIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzAsMSwiaV9TIl1d
\[\begin{tikzcd}
	A & {S^{-1}A} \\
	& B
	\arrow["{i_S}", from=1-1, to=1-2]
	\arrow["\alpha"', from=1-1, to=2-2]
	\arrow["{\exists !}", dashed, from=1-2, to=2-2]
\end{tikzcd}\]
特别地, 局部化是同构意义下唯一的.
\end{proposition}

设 \( h \in A \), 那么 \( S_h = \left\lbrace 1, h, h^2, \ldots \right\rbrace \)
是 \( A \) 的一个乘性子集. 我们简记 \( S_h^{-1}A \) 为 \( A_h \).

\begin{proposition}
  给定一个环 \( A \) 和 \( h \in A \), 映射
  \[
    \sum a_i X^i \mapsto \sum \frac{a_i}{h^i}
  \]
  给出了同构
  \[
    A[X] / (1 - hX) \to A_h.
  \]
\end{proposition}
\begin{proof}
  假设 \( h \in \operatorname{nil} A \), 那么 \( hX \in \operatorname{nil} A[X]
  \).
  而 \( \operatorname{nil}A[X] \) 包含于 \( A[X] \) 的 Jacobson 根中,
  于是由\cref{proposition-Jacobson-root-iff-condition} 得到 \( (1 - hX) = A[X]
  \), 即 \( A[X] / (1 - hX) = 0 \).
  结合\cref{remark-fraction-ring} 知道 \( A_h = 0 \), 故这是一个同构.

  假设 \( h \notin \operatorname{nil} A \).
  记 \( A[x] = A[X] / (1 - hX)\), 那么 \( 1 = hx \), 即 \( h \) 在 \( A[x] \)
  中可逆.
  由\cref{proposition-universal-property-localization}, 自然态射 \( A \to A[x]
  \) 可以分解为 \( A \xrightarrow{i} A_h \xrightarrow{\alpha} A[x]  \), 可以验证
  \( \alpha \) 和命题中映射互逆.
\end{proof}

\paragraph{局部化下的理想对应} 假设 \( S \) 是一个 \( A \) 的乘性子集, \( S^{-1}
A \) 为对应局部化. \( A \) 的理想 \( \mathfrak{a} \) 在 \( S^{-1}A \)
中生成的理想为
\[
  S^{-1} \mathfrak{a} = \left\lbrace \frac{a}{s}: a \in \mathfrak{a}, s \in S
  \right\rbrace.
\]
\begin{proposition}
  \label{proposition-local-ideal-contraction-and-extension}
  假设 \( S \) 是 \( A \) 的乘性子集, 自然态射 \( i_S: A \to  S^{-1} A \)
  具有下面性质:
  \begin{enumerate}
    \item 对所有 \( S^{-1} A \) 的理想 \( \mathfrak{b} \), 有 \(
      \mathfrak{b}^{ce} = \mathfrak{b} \).
    \item 如果 \( \mathfrak{p} \) 是 \( A \) 的一个不交于 \( S \) 的素理想, 那么
      \( \mathfrak{p}^{ec} = \mathfrak{p} \).
      特别地, 每个这样的 \( \mathfrak{p} \) 都是 \( S^{-1} A \)
      中某个素理想的收缩.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \( \mathfrak{b}^{ce} \supset \mathfrak{b} \).
  对任意 \( \frac{a}{s} \in \mathfrak{b} \), \( s\frac{a}{s} = \frac{a}{1} \in
  \mathfrak{b} \).
  因此 \( a \in \mathfrak{b}^c \). 而 \( \frac{a}{s} = a \frac{1}{s}
  \in \mathfrak{b}^{ce} \).

  \( \mathfrak{a}^{ec} \subset \mathfrak{p} \).
  对任意 \( a \in \mathfrak{p}^{ec} \), 存在 \( a' \in \mathfrak{p}, s \in S \)
  使得 \( \frac{a}{1} = \frac{a'}{s} \).
  由局部化定义 \( t \in S \) 使得 \( tsa = ta' \in \mathfrak{p} \).
  由条件 \( S \cap \mathfrak{p} = \varnothing \) 以及 \( ts \in S \), 只能 \( a
  \in \mathfrak{p} \).
  最后一个论断由\cref{proposition-prime-as-contraction-iff-homomorphism-condition}保证.
\end{proof}

\begin{proposition}
  \label{proposition-local-prime-ideal-correspondence}
  下面映射互为双射
  \[
    \begin{split}
      \left\lbrace A \text{中不交} S \text{的素理想} \right\rbrace
      &\leftrightarrow \left\lbrace S^{-1} A \text{的素理想} \right\rbrace\\
      \mathfrak{p} &\mapsto \mathfrak{p}^e\\
      \mathfrak{q}^c &\mapsfrom \mathfrak{q}
    \end{split}
  \]
\end{proposition}
\begin{proof}
  由\cref{proposition-local-ideal-contraction-and-extension}, 只需再验证对 \(
  S^{-1}A \) 的任意素理想 \( \mathfrak{q} \), \( \mathfrak{q}^c \) 是不交 \( S
  \) 的素理想.
  假设不然, 存在 \( s \in \mathfrak{q}^c \cap S \), 那么 \( \frac{s}{1} \in
  \mathfrak{q}^{ce} = \mathfrak{q} \), 也就是 \( \mathfrak{q} = S^{-1} A \),
  这与 \( \mathfrak{q} \) 素矛盾.
\end{proof}

\paragraph{局部化与商交换}
\begin{proposition}
  假设 \( \mathfrak{p} \) 是一个不交于 \( S \) 的 \( A \) 的素理想, 令 \(
  \overline{S} \) 为 \( S \) 在 \( A / \mathfrak{p} \) 中的像.
  那么
  \[
    (S^{-1} A) / \mathfrak{p}^e \simeq \overline{S}^{-1} (A / \mathfrak{p}),
  \]
  也就是说, 此时局部化和商是可交换的.
\end{proposition}
\begin{proof}
  由条件, 合成映射 \( A \to A / \mathfrak{p} \to \overline{S}^{-1}(A /
  \mathfrak{p}) \) 将 \( S \) 中元素映到可逆元,
  故可通过\cref{proposition-universal-property-localization}提升为
  \( S^{-1} A \to \overline{S}^{-1}(A / \mathfrak{p}) \);
  而 \( \mathfrak{p}^e \) 在此态射中像为零, 故可以进一步提升 \( (S^{-1} A)
  /\mathfrak{p}^e \to \overline{S}^{-1} (A/ \mathfrak{p})\).

  合成态射 \( A \to S^{-1} A \to S^{-1} A / \mathfrak{p}^e \) 将 \( \mathfrak{p}
  \) 映到零, 故可提升为 \( A / \mathfrak{p} \to S^{-1} A / \mathfrak{p}^e \), \(
  \overline{S} \) 中元素均被此映射映到可逆元,
  故又由\cref{proposition-universal-property-localization} 可提升为 \(
  \overline{S}^{-1}(A / \mathfrak{p}) \to S^{-1} A / \mathfrak{p}^e  \).

  可以验证两个映射互逆.
\end{proof}

\paragraph{在素理想处的局部化}
令 \( \mathfrak{p} \) 为 \( A \) 的素理想, 那么 \( S_{\mathfrak{p}} := A
\setminus \mathfrak{p} \) 为 \( A \) 的乘性子集, 此时记 \( A_{\mathfrak{p}} =
S_{\mathfrak{p}}^{-1} A \),
由\cref{proposition-local-prime-ideal-correspondence}有
\[
  \operatorname{Spec}(A_\mathfrak{p}) \simeq \left\lbrace \mathfrak{q} \in
  \operatorname{Spec} A: \mathfrak{q} \subseteq \mathfrak{p} \right\rbrace.
\]
因此 \( A_{\mathfrak{p}} \) 是一个极大理想为 \( \mathfrak{p}^{e} \) 的局部环.

\begin{proposition}
  假设 \( \mathfrak{m} \) 是环 \( A \) 的极大理想, \( \mathfrak{n} =
  \mathfrak{m} A_{\mathfrak{m}} \), 那么对所有自然数 \( n \),
  \begin{enumerate}
    \item \( A/\mathfrak{m}^n \) 是局部环, 其极大理想即 \(
      \mathfrak{m}/\mathfrak{m}^n \).
    \item 映射
      \[
        \varphi: A / \mathfrak{m}^n \to A_{\mathfrak{m}} / \mathfrak{n}^n \quad a +
        \mathfrak{m}^n \mapsto a + \mathfrak{n}^n
      \]
      是同构.
    \item 对所有 \( r \leq n \), 下面同构成立
      \[
        \mathfrak{m}^r / \mathfrak{m}^n \to \mathfrak{n}^r / \mathfrak{n}^n.
      \]
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) \( A \) 中包含 \( \mathfrak{m}^n \) 的极大理想包含 \( \operatorname{rad}
  (\mathfrak{m}^n) = \mathfrak{m} \), 只能等于 \( \mathfrak{m} \).

  (2)
  \( \varphi \) 单.
  因为 \( \mathfrak{n}^n = (\mathfrak{m}^n)^e \), 所以 \( \operatorname{ker}
  \varphi = (\mathfrak{m}^n)^{ec} / \mathfrak{m}^n \).
  设 \( a \in (\mathfrak{m}^n)^{ec} \), 那么存在 \( b \in \mathfrak{m}^n, s
  \notin \mathfrak{m} \), 使得 \( \frac{a}{1} = \frac{b}{s} \), 于是存在某个 \(
  t \notin \mathfrak{m} \), 使得 \( tsa \in \mathfrak{m}^n \).
  而  \( ts \notin \mathfrak{m} \),
  由(1)和\cref{proposition-Jacobson-root-iff-condition}, \( ts \) 是 \( A /
  \mathfrak{m}^n \) 中的单位, 故 \( a \in \mathfrak{m}^n \).

  \( \varphi \) 满.
  设 \( a/s \in A_{\mathfrak{m}} \), 其中 \( a \in A, s \notin
  \mathfrak{m}\).
  再由(1)和\cref{proposition-Jacobson-root-iff-condition}, \( s \) 是 \(
  A/\mathfrak{m}^n \) 中的单位, 即\( (s) + \mathfrak{m}^n = A \).
  因此存在 \( b \in A \) 和 \( q \in
  \mathfrak{m}^n \) 使得 \( sb + q = 1 \). 因此
  \[
    s(ba) = a(1 - q).
  \]
  因此在 \( A_{\mathfrak{m}} \) 上
  \[
    \frac{ba}{1} = \frac{a}{s} - \frac{aq}{s}.
  \]
  换句话说 \( \varphi(\overline{ba}) = \overline{a/s} \).

  (3) 由下图, (3)是(2)和五引理的直接推论
% https://q.uiver.app/#q=WzAsMTAsWzAsMCwiMCJdLFswLDEsIjAiXSxbNCwwLCIwIl0sWzQsMSwiMCJdLFsxLDAsIlxcbWF0aGZyYWt7bX1eciAvIFxcbWF0aGZyYWt7bX1ebiJdLFsxLDEsIlxcbWF0aGZyYWt7bn1eciAvIFxcbWF0aGZyYWt7bn1ebiJdLFsyLDAsIkEgLyBcXG1hdGhmcmFre219Xm4iXSxbMywwLCJBIC8gXFxtYXRoZnJha3ttfV5yIl0sWzIsMSwiQV97XFxtYXRoZnJha3ttfX0gLyBcXG1hdGhmcmFre259Xm4iXSxbMywxLCJBX3tcXG1hdGhmcmFre219fSAvIFxcbWF0aGZyYWt7bn1eciJdLFsxLDVdLFswLDRdLFs0LDVdLFs0LDZdLFs1LDhdLFs2LDgsIlxcc2ltZXEiLDFdLFs2LDddLFs4LDldLFs3LDJdLFs5LDNdLFs3LDksIlxcc2ltZXEiLDFdXQ==
\[\begin{tikzcd}
	0 & {\mathfrak{m}^r / \mathfrak{m}^n} & {A / \mathfrak{m}^n} & {A / \mathfrak{m}^r} & 0 \\
	0 & {\mathfrak{n}^r / \mathfrak{n}^n} & {A_{\mathfrak{m}} / \mathfrak{n}^n} & {A_{\mathfrak{m}} / \mathfrak{n}^r} & 0
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-2, to=2-2]
	\arrow[from=1-3, to=1-4]
	\arrow["\simeq"{description}, from=1-3, to=2-3]
	\arrow[from=1-4, to=1-5]
	\arrow["\simeq"{description}, from=1-4, to=2-4]
	\arrow[from=2-1, to=2-2]
	\arrow[from=2-2, to=2-3]
	\arrow[from=2-3, to=2-4]
	\arrow[from=2-4, to=2-5]
\end{tikzcd}\]
\end{proof}

\subsection{分式模}

\begin{proposition}
  函子 \( M \to S^{-1} M \) 是正合函子.
\end{proposition}
\begin{proof}
  假设给定了正合列
  \[
    M' \xrightarrow{\alpha} M \xrightarrow{\beta} M''
  \]

  \( \operatorname{Im} (S^{-1} \alpha) \subset \operatorname{Ker} (S^{-1}\beta)
  \) 是因为 \( 0 = S^{-1}(\beta \circ \alpha) = S^{-1} \beta \circ S^{-1} \alpha
  \).

  \(  \operatorname{Im} (S^{-1} \alpha) \supset \operatorname{Ker} (S^{-1}\beta)
   \).
  设 \( \frac{m}{s} \in \operatorname{Ker}(S^{-1}\beta) \), 其中 \( m \in M, s
  \in S \).
  那么存在 \( t \in S \) 使得 \( t(\beta(m)) = \beta(tm) = 0 \).
  由原列的正合性, 存在 \( m' \in M' \) 使得 \( tm = \alpha(m') \).
  因此
  \[
    \frac{m}{s} = \frac{tm}{ts} = \frac{\alpha(m')}{ts} \in
    \operatorname{Im}(S^{-1}\alpha).
  \]
\end{proof}

\paragraph{模为零的充要条件}
\begin{proposition}
  假设 \( M \) 是一个\( A \)-模. 那么典范映射
  \[
    M \to \prod \left\lbrace M_{\mathfrak{m}}: \mathfrak{m} \text{是} A
    \text{的一个极大理想} \right\rbrace
  \]
  是一个单射.
\end{proposition}
\begin{proof}
  假设不然, 存在\( 0 \neq  x \) 在此映射下像为零, 那么存在极大理想 \( \mathfrak{m} \)
  包含 \( \operatorname{ann}(x) \).
  于是 \( x \) 在 \( M \to M_{\mathfrak{m}} \)
  下像非零, 矛盾.
\end{proof}

\begin{corollary}
  \label{corollary-module-zero-iff-condition}
  假设 \( M \) 是一个 \( A \)-模. 如果 \( M_{\mathfrak{m}} = 0 \) 对所有 \( A \)
  的极大理想 \( \mathfrak{m} \) 成立, 那么 \( M = 0 \).
\end{corollary}

\paragraph{模复形链正合的充要条件}

\begin{proposition}
  复形链
  \[
    M' \xrightarrow{\alpha} M \xrightarrow{\beta} M''
  \]
  正合当且仅当对 \( A \) 的所有极大理想 \( \mathfrak{m} \) , 列
  \[
    M'_{\mathfrak{m}} \xrightarrow{\alpha_{\mathfrak{m}}} M_{\mathfrak{m}}
    \xrightarrow{\beta_{\mathfrak{m}}} M''_{\mathfrak{m}}
  \]
  正合.
\end{proposition}
\begin{proof}
  只需证明 \( \impliedby \).
\end{proof}

\begin{corollary}
  \label{corollary-local-global-module-morphism}
  一个 \( A \)-模态射 \( M \to N \) 单(resp. 满, 零) 当且仅当 \(
  M_{\mathfrak{m}} \to N_{\mathfrak{m}} \) 单(resp. 满, 零).
\end{corollary}
\begin{proof}
  考虑 \( 0 \to M \to N \)(resp. \( M \to N \to 0, M
  \xrightarrow{\operatorname{id}} M \to N \)).
\end{proof}

\paragraph{环约化充要条件}

\begin{proposition}
  假设 \( S \) 为 \( A \) 的一个乘性子集, 那么
  \[
    S^{-1} \operatorname{nil}(A) = \operatorname{nil}(S^{-1}A).
  \]
\end{proposition}
\begin{proof}
  如果 \( (\frac{a}{s})^n = 0 \) 对某个 \( n \) 成立, 其中 \( a \in A, s \in S \).
  那么存在 \( t \in S \) 使得 \( ta^n = 0 \), 因此 \( \frac{a}{s} =
  \frac{ta}{ts} \in S^{-1} \operatorname{nil} (A) \).
\end{proof}

\begin{corollary}
  环 \( A \) 约化当且仅当 \( A_{\mathfrak{m}} \) 均约化.
\end{corollary}

\section{整性}

\subsection{基本性质}

假设 \( A \) 是环 \( B \) 的子环. 一个 \( B \) 的元素 \( \alpha \) 称为在 \( A
\) 上\emph{整}, 如果 \( \alpha \) 是 \( A \) 的一个首一系数多项式的根,
也就是它满足某个形如下面的方程
\[
  x^n + a_1 x^{n - 1} + \cdots + a_n = 0,\quad a_i \in A.
\]
更一般地, 一个 \( A \)-代数 \( B \) 的元素称为在 \( A \) 上\emph{整}, 如果它在
\( A \) 在 \( B \) 的像中整. 如果 \( B \) 的每个元素都在 \( A \) 中整, 那么称 \( B
\) 在 \( A \) 中\emph{整}.

\begin{lemma}[Cramer]
  \label{lemma-Cramer-varient}
  假设 \( x_j \) 是 \( A \)-系数线性方程
  \[
    \sum_{j = 1}^m c_{ij} x_j = 0,\quad i = 1, \ldots, m,
  \]
  的解, 那么
  \[
    \det(C) \cdot x_j = 0,\quad j = 1,\ldots, m.
  \]
\end{lemma}
\begin{proof}
  考察
  \[
    \det \begin{pmatrix}
      c_{11} &\cdots &c_{1, j - 1} &\sum_{i} &c_{1i} x_{i} &c_{1, j + 1} &\cdots
      &c_{1m}\\ \vdots &&\vdots &\vdots &\vdots &&\vdots\\ c_{m1} &\cdots
      &c_{m, j - 1} &\sum_{i} &c_{mi} x_{i} &c_{m, j + 1} &\cdots &c_{mm}
    \end{pmatrix} = 0
  \]
\end{proof}

\begin{proposition}
  \label{proposition-integral-iff-condition}
  假设环 \( B \) 是 \( A \) 的扩张. \( B \) 的一个元素 \( \alpha \) 在 \( A \)
  上整当且仅当存在 \( B \) 的忠实 \( A[\alpha] \)-子模作为 \( A \)-模有限.
\end{proposition}
\begin{proof}
  \( \implies \) 考虑 \( A[\alpha] \) 即可. \( \impliedby \) 假设 \( C \)
  是一个由极小生成元 \( c_1,\ldots, c_n \) 生成的忠实\( A[\alpha] \)-子模, 那么
  \[
    \alpha c_i = a_{i1}c_1 + a_{i2}c_2 + \cdots + a_{in}c_n
  \]
  记
  \[
    C = \begin{pmatrix}
      \alpha - a_{11} &-a_{12} &\cdots &-a_{1n}\\
      -a_{21} &\alpha - a_{12} &\cdots &-a_{2n}\\
      \vdots &\vdots &\ddots &\vdots\\
      -a_{n1} &-a_{n2} &\cdots &\alpha-a_{nn}\\
    \end{pmatrix}
  \]
  那么由\cref{lemma-Cramer-varient}有 \( \det(C) e_i = 0 \).
  由忠实性, \( \det(C) = 0 \), 展开 \( \det(C) \), 可以找到 \( b \) 满足一个首一
  \( A \)-系数多项式.
\end{proof}


\begin{proposition}
  \label{proposition-finite-generated-integral-algebra-as-finite-module}
  如果 \( A \)-代数 \( B \) 有限生成且每个元素都在 \( A \) 上整, 那么 \( B \)
  作为 \( A \)-模有限.
\end{proposition}
\begin{proof}
  假设 \( B \) 由 \( \alpha_1, \ldots, \alpha_m \) 生成, 并且
  \[
    \alpha_i^{n_i} + a_{i1}\alpha_{i}^{n_i - 1} + \cdots + a_{in_i} =
    0,\quad a_{ij} \in A,\quad i = 1,\ldots, m.
  \]
  那么 \( B \) 由 \( \alpha_1^{r_i}\cdots \alpha_m^{r_m}, 1 \leq r_i < n_i
  \) 生成.
\end{proof}

\begin{corollary}
  考虑环 \( A \subseteq B \subseteq C \).  \( B \) 在 \( A \) 上整并且 \( C \)
  在 \( B \) 上整当且仅当 \( C \) 在 \( A \) 上整.
\end{corollary}
\begin{proof}
  \( \implies \) 假设 \( c \in C \) 满足
  \[
    c^{n} + b_{1}c_{i}^{n - 1} + \cdots + b_{n} = 0,\quad b_{i} \in B,\quad i =
    1,\ldots, n.
  \]
  那么 \( A[b_1, \ldots, b_n, c] \) 在 \( A[b_1, \ldots, b_n] \) 上有限,
  而由\cref{proposition-finite-generated-module-over-noetherian-ring} \( A[b_1,
  \ldots, b_n] \) 在 \( A \) 上有限, 于是 \( A[b_1, \ldots, b_n, c] \) 在 \( A
  \) 上有限, 于是由\cref{proposition-integral-iff-condition}, \( c \) 在 \( A \)
  上整.
\end{proof}

\subsection{整闭包}

\begin{theorem}
  \label{theorem-integral-closure}
  假设 \( A \) 为 \( B \) 的子环, 那么 \( B \) 在 \( A \) 上的整的元素构成一个
  \( B \) 的 \( A \)-子代数.
  我们称 \( A \) 在 \( B \) 的\emph{整闭包}为 \( B \) 在 \( A \) 中的所有整元素.
  特别地, 在没有歧义的情况下, 如果 \( A \) 是一个整环, \( A \)
  在其分式域的整闭包称为 \( A \) 的\emph{整闭包}.
\end{theorem}

\begin{proposition}
  假设 \( A \) 是一个整环, 其分式域为 \( F \), \( E \) 是一个包含 \( F \) 的域.
  如果 \( \alpha \in E \) 在 \( F \) 上代数, 那么存在\( d \in A \) 使得 \( d
  \alpha \) 在 \( A \) 上整.
\end{proposition}

\begin{corollary}
  如果 \( A \) 是一个整环, \( E \) 是 \( A \) 的分式域的整扩张, 那么 \( E \)
  是 \( A \) 在 \( E \) 中整闭包的分式域.
\end{corollary}

\paragraph{整闭整环} 一个整环 \( A \) 称为是\emph{整闭的} 或者\emph{正规的},
如果它等于它在自身分式域上的整闭包, 换句话说
\[
  \alpha \in F,\quad \alpha \text{在} A \text{中整} \implies \alpha \in A.
\]

假设 \( F \subseteq E \) 均为域, \( \alpha \in E \) 在 \( F \) 上代数. \( \alpha
\) 在 \( F \) 上的\emph{极小多项式}是首一的 \( \alpha \) 的最小多项式.

\begin{proposition}
  假设 \( A \) 是一个正规整环, \( E \) 是 \( A \) 的分式域 \( F \)
  的一个有限扩张. \( E \) 的一个元素 \( \alpha \) 在 \( A \) 上整当且仅当其在 \(
  F \) 上的极小多项式系数均在 \( A \) 上.
\end{proposition}
\begin{proof}
  只需验证 \( \implies \).
  假设 \( \alpha \) 在 \( A \) 上整, \( f \) 为 \( \alpha \) 在 \( F \)
  上的极小多项式, 那么 \( f \) 的所有根都在 \( A \) 上整.
  由\cref{proposition-splitting-polynomial-ring} \( f \) 的系数是 \( f \)
  根的代数组合, 因此由\cref{theorem-integral-closure}, 这些系数在 \( A \) 上整,
  又由 \( A \) 整闭, 这些系数都在 \( A \) 上.
\end{proof}

\begin{corollary}
  假设 \( A \) 是一个分式域为 \( F \) 的整闭整环, \( f \) 是 \( A[X] \)
  的一个首一系数多项式, 那么 \( f \) 在 \( F[X] \) 中的每个首一系数因子系数都在
  \( A \) 中.
\end{corollary}

\paragraph{整闭的局部性质}

\begin{proposition}
  假设 \( B \) 为一个 \( A \) 代数, \( A' \) 为 \( A \) 在 \( B \) 的整闭包.
  对每个 \( A \) 的在结构同态下像不含零的乘性子集 \( S \), \( S^{-1}A' \)
  为 \( S^{-1} A \) 在 \( S^{-1} B \) 的整闭包.
\end{proposition}
\begin{proof}
  假设 \( b/s \in S^{-1}A' \) 其中 \( b \in A' \) 和 \( s \in S \), 那么有
  \[
    b^n + a_1 b^{n - 1} + \cdots + a_n = 0,\quad a_i \in A,
  \]
  因此
  \[
    \left(\frac{b}{s}\right)^n + \frac{a_1}{s} \left( \frac{b}{s} \right)^{n -
    1} + \cdots + \frac{a_n}{s^n} = 0
  \]
  \( b/s \) 在 \( S^{-1}A \) 上整.

  反过来, 假设 \( b / s \) 在 \( S^{-1}A \) 上整, 其中 \( b \in B, s \in S \), 那么有
  \[
    \left( \frac{b}{s} \right)^n + \frac{a_1}{s_1} \left( \frac{b}{s} \right)^{n
    - 1} + \cdots + \frac{a_n}{s_n} = 0,\quad a_i \in A,\quad s_i S.
  \]
  同乘 \( s^n s_1^n \cdots s_n^n \), 知道 \( s_1 \cdots s_n b \in A' \), 于是 \(
  b/s \in S^{-1} A \).
\end{proof}

\begin{corollary}
  假设 \( A \subseteq B \) 是环, \( S \) 是 \( A \) 的一个乘性子集. 如果 \( A \)
  在 \( B \) 中整闭, 那么 \( S^{-1} A \) 在 \( S^{-1} B \) 中整闭.
\end{corollary}

\begin{proposition}
  假设 \( A \) 是一个整环, 那么下面条件等价
  \begin{enumerate}
    \item \( A \) 整闭.
    \item 对所有素理想 \( \mathfrak{p} \), \( A_{\mathfrak{p}} \) 整闭.
    \item 对所有极大理想 \( \mathfrak{m} \), \( A_{\mathfrak{m}} \) 整闭.
  \end{enumerate}
\end{proposition}
\begin{proof}
  (3) \( \implies \) (1).
  假设 \( A' \) 为 \( A \) 的整闭包, 那么由 (3) 对所有极大理想 \( \mathfrak{m} \), \(
  A_{\mathfrak{m}} \to (A')_{\mathfrak{m}} \) 满,
  因此由\cref{corollary-local-global-module-morphism} \( A \to A' \) 满.
\end{proof}

\paragraph{整闭与多项式}

\begin{lemma}
  \label{lemma-integral-monic-factor}
  如果 \( A \) 是一个环, \( B \) 是一个 \( A \)-代数, \( f, g \in B[T] \)
  为首一多项式使得 \( f \) 的系数在 \( A \) 上整且 \( g \mid f \), 那么 \( g \)
  的系数也在 \( A \) 上整.
\end{lemma}
\begin{proof}
  \cref{proposition-splitting-polynomial-ring}.
\end{proof}

\begin{proposition}
  \label{proposition-polynomial-integral-implies-coefficient-integral}
  假设 \( B \) 是一个 \( A \)-代数. 如果 \( P \in B[T] \) 在 \( A[T] \) 中整,
  那么 \( P \) 的系数都在 \( A \) 中整.
\end{proposition}
\begin{proof}
  假设 \( P \in B[T] \) 为多项式
  \[
    q(X) = X^n + f_1 X^{n - 1} + \cdots + f_n,\quad f_i \in A[T]
  \]
  的根.
  令 \( r \) 为一个大于 \( \deg f_1,\ldots, \deg f_n \) 的整数, \( P_1 = P - T^r
  \), 以及
  \[
    q_1(X) = q(X + T^r) = X^n + g_1 X^{n - 1} + \cdots + g_n,\quad g_i \in A[T].
  \]
  那么 \( P_1 \) 为 \( q_1(X) \) 的一个根, 因此
  \[
    g_n = -P_1 \cdot (P^{n - 1}_1 + g_1 P^{n - 2}_1 + \cdots + g_{n - 1}).
  \]
  由 \( r \) 的选择知道, \( g_n \) 或 \( -g_n \) 是首一的.
  结合 \( g_n \) 系数在 \( A \) 中以及\cref{lemma-integral-monic-factor}, 知道
  \( P_1 \) 系数在 \( A \) 中整, 因此 \( P \) 系数在 \( A \) 中整.
\end{proof}

\begin{proposition}
  整闭整环的多项式环都是整闭整环.
\end{proposition}
\begin{proof}
  只需证明, 如果 \( A \) 是一个整闭整环, 那么 \( A[T] \) 亦是一个整闭整环.
  假设 \( F \) 是 \( A \) 的分式域.
  如果 \( A[T] \) 的分式域 \( F(T) \) 的一个元素 \( f \) 在 \( A[T] \) 中整,
  那么它在 \( F[T] \) 中整.
  而 \( F[T] \) 是一个唯一因子分解整环, 其分式域亦为 \( F(T) \), 因此 \( f \in
  F[T] \).
  因此由\cref{proposition-polynomial-integral-implies-coefficient-integral}, \(
  f \) 系数在 \( A \) 中整, 结合 \( A \) 整闭, \( f \in A[T] \).
\end{proof}

\subsection{上升下降定理}

\begin{proposition}
  如果 \( A \subseteq B \) 为整环, \( B \) 在 \( A \) 上整, 那么 \( B \)
  是一个域当且仅当 \( A \) 是一个域.
\end{proposition}
\begin{proof}
  \( \implies \). 假设 \( 0 \neq \alpha \in A \), 那么 \( \alpha^{-1} \in B \)
  在 \( A \) 上整. 因此存在 \( \alpha_i \in A \) 使得
  \[
    (\alpha^{-1})^n + a_1(\alpha^{-1})^{n - 1} + \cdots + a_n = 0.
  \]
  两边同乘 \( a^{n - 1} \) 立刻知道 \( \alpha^{-1} \in A \).

  \( \impliedby \). 假设 \( 0 \neq \alpha \in B \) 在 \( A \) 上整,
  那么能找到一个 \( \alpha \) 次数最低的方程
  \[
    \alpha^n + a_1\alpha^{n - 1} + \cdots + a_n = 0,\quad a_i \in A.
  \]
  显然 \( a_n \neq 0 \), 因此
  \[
    (-a_n)^{-1}(\alpha^{n - 1} + a_1\alpha^{n - 2} + \cdots + a_{n - 1})\alpha =
    1,
  \]
  也就是 \( \alpha \) 在 \( B \) 中有逆.
\end{proof}

\begin{corollary}
  假设 \( B \) 是一个 \( A \)-代数, \( B \) 在 \( A \) 上整, \( \mathfrak{q} \)
  为\( B \) 的一个素理想, \( \mathfrak{p} = \mathfrak{q} \cap A \).
  那么 \( \mathfrak{q} \) 极大当且仅当 \( \mathfrak{p} \) 极大.
\end{corollary}
\begin{proof}
  考虑 \(  A / \mathfrak{p} \hookrightarrow B / \mathfrak{q} \).
\end{proof}

\begin{corollary}[不相容性]
  假设 \( \varphi: A \to B \) 为环同态, \( B \) 在 \( A \) 上整, 并且 \(
  \mathfrak{q} \subset \mathfrak{q}' \) 为 \( B \) 的素理想.
  如果 \( \mathfrak{q} \cap A = \mathfrak{q}' \cap A \), 那么 \( \mathfrak{q} =
  \mathfrak{q}' \).
  换句话说, 素谱态射 \( {}^a \varphi: \operatorname{Spec} B \to \operatorname{Spec} A \)
  单.
\end{corollary}
\begin{proof}
  设 \( \mathfrak{p} = \mathfrak{q} \cap A = \mathfrak{q}' \cap A \). 那么 \(
  A_{\mathfrak{p}} \subseteq B_{\mathfrak{p}} \) 且 \( B_{\mathfrak{p}} \) 在 \(
  A_{\mathfrak{p}} \) 上整.
  理想 \( \mathfrak{q} B_{\mathfrak{p}} \subseteq \mathfrak{q}' B_{\mathfrak{p}}
  \) 均为 \( B_{\mathfrak{p}} \) 的素理想且交 \( A_{\mathfrak{p}}\) 于 \(
  \mathfrak{p}A_{\mathfrak{p}} \), 后者为 \( \mathfrak{p}A_{\mathfrak{p}} \)
  的极大理想.
  因此 \( \mathfrak{q} B_{\mathfrak{p}} = \mathfrak{q}' B_{\mathfrak{p}} \)
  均为极大理想.
  因此有收缩的等式
  \[
    \mathfrak{q} = (\mathfrak{q}B_{\mathfrak{p}})^c =
    (\mathfrak{q}'B_{\mathfrak{p}})^c = \mathfrak{q}'.
  \]
\end{proof}

\begin{proposition}
  假设 \( A \subseteq B \) 为环且 \( B \) 在 \( A \) 上整且 \( \mathfrak{p} \)
  为 \( A \) 的素理想. 那么存在 \( B \) 的素理想 \( \mathfrak{q} \) 使得 \(
  \mathfrak{p} = \mathfrak{q} \cap A \).
\end{proposition}
\begin{proof}
  由假设我们有 \( A_{\mathfrak{p}} \subseteq B_{\mathfrak{p}} \), 且 \(
  B_{\mathfrak{p}} \) 在 \( A_{\mathfrak{p}} \) 上整. 假设 \( \mathfrak{n} \) 为
  \( B_{\mathfrak{p}} \) 的一个极大理想, \( \mathfrak{q} = \mathfrak{n} \cap B
  \). 由下图可以知道 \( \mathfrak{q} \cap A = \mathfrak{p} \).
  % https://q.uiver.app/#q=WzAsNCxbMCwxLCJBIl0sWzEsMSwiQV97XFxtYXRoZnJha3twfX0iXSxbMSwwLCJCX3tcXG1hdGhmcmFre3B9fSJdLFswLDAsIkIiXSxbMCwzXSxbMCwxXSxbMSwyXSxbMywyXV0=
  \[\begin{tikzcd}
    B & {B_{\mathfrak{p}}} \\
    A & {A_{\mathfrak{p}}}
    \arrow[from=1-1, to=1-2]
    \arrow[from=2-1, to=1-1]
    \arrow[from=2-1, to=2-2]
    \arrow[from=2-2, to=1-2]
  \end{tikzcd}\]
\end{proof}

\begin{theorem}
  假设 \( A \subseteq B \) 为环并且 \( B \) 在 \( A \) 上整. 如果 \(
  \mathfrak{p} \subseteq \mathfrak{p}' \) 为 \( A \) 的素理想且 \( \mathfrak{q}
  \) 为 \( B \) 的素理想使得 \( \mathfrak{q} \cap A = \mathfrak{p} \), 那么存在
  \( B \) 的素理想 \( \mathfrak{q}' \) 使得 \( \mathfrak{q}' \cap A =
  \mathfrak{p}' \).
  % https://q.uiver.app/#q=WzAsNixbMCwwLCJCIl0sWzAsMSwiQSJdLFsxLDAsIlxcbWF0aGZyYWt7cX0iXSxbMSwxLCJcXG1hdGhmcmFre3B9Il0sWzIsMCwiXFxtYXRoZnJha3txfSciXSxbMiwxLCJcXG1hdGhmcmFre3B9JyJdLFszLDUsIlxcc3Vic2V0IiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzIsNCwiXFxzdWJzZXQiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMywyLCIiLDEseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzUsNCwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSwwLCIiLDEseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
  \[\begin{tikzcd}
    B & {\mathfrak{q}} & {\mathfrak{q}'} \\
    A & {\mathfrak{p}} & {\mathfrak{p}'}
    \arrow["\subset"{description}, draw=none, from=1-2, to=1-3]
    \arrow[no head, from=2-1, to=1-1]
    \arrow[no head, from=2-2, to=1-2]
    \arrow["\subset"{description}, draw=none, from=2-2, to=2-3]
    \arrow[dashed, no head, from=2-3, to=1-3]
  \end{tikzcd}\]
\end{theorem}
\begin{proof}
  考察 \( A / \mathfrak{p} \hookrightarrow B / \mathfrak{q} \), 存在素理想 \(
  \mathfrak{q}'' \in B / \mathfrak{q} \) 使得 \( \mathfrak{q}'' \cap (A /
  \mathfrak{p}) = \mathfrak{p}' / \mathfrak{p} \), 考虑下面的交换图即可.
  % https://q.uiver.app/#q=WzAsNCxbMCwxLCJBIl0sWzEsMSwiQS9cXG1hdGhmcmFre3B9Il0sWzEsMCwiQi9cXG1hdGhmcmFre3F9Il0sWzAsMCwiQiJdLFswLDNdLFswLDFdLFsxLDJdLFszLDJdXQ==
  \[\begin{tikzcd}
    B & {B/\mathfrak{q}} \\
    A & {A/\mathfrak{p}}
    \arrow[from=1-1, to=1-2]
    \arrow[from=2-1, to=1-1]
    \arrow[from=2-1, to=2-2]
    \arrow[from=2-2, to=1-2]
  \end{tikzcd}\]
\end{proof}

\begin{corollary}
  假设 \( A \subseteq B \) 为环且 \( B \) 在 \( A \) 上整, 且 \( \mathfrak{p}_1
  \subseteq \cdots \subseteq \mathfrak{p}_n \) 为 \( A \) 的素理想.
  令素理想包含链
  \[
    \mathfrak{q}_1 \subseteq \cdots \subseteq \mathfrak{q}_m \quad (m < n)
  \]
  为 \( B \) 的素理想使得 \( \mathfrak{q}_i \cap A = \mathfrak{p} \) 对所有 \( i
  \leq m \) 成立, 那么此素理想包含链可以扩张为
  \[
    \mathfrak{q}_1 \subseteq \cdots \subseteq \mathfrak{q}_n
  \]
  使得 \( \mathfrak{q}_i \cap A = \mathfrak{p} \), 其中 \( i \leq n \).
\end{corollary}

\paragraph{理想上整} 假设 \( A \subseteq B \) 为环, \( \mathfrak{a} \) 为
\( A \) 的一个理想. \( B \) 的一个元素 \( b \) 称为在 \( \mathfrak{a} \)
上\emph{整}, 如果其满足方程
\[
  b^n + a_1 b^{n - 1} + \cdots + a_n = 0,
\]
其中 \( a_i \in \mathfrak{a} \). \( B \) 在 \( \mathfrak{a} \) 上的
\emph{整闭包} 为 \( B \) 在 \( \mathfrak{a} \) 上整的元素.

类似于 \cref{proposition-integral-iff-condition}, 我们可以知道
\begin{proposition}
  如果一个 \( B \) 的忠实 \( A[b] \)-子模 \( M \), 其作为 \( A \)-模有限生成,
  使得 \( b M \subseteq \mathfrak{a} M \), 那么 \( b \in B \) 在 \( \mathfrak{a}
  \) 上整.
\end{proposition}

\begin{lemma}
  如果 \( A \) 在 \( B \) 的整闭包为 \( A' \), 那么 \( \mathfrak{a} \) 在 \( B
  \) 中的整闭包是 \( \operatorname{rad}(\mathfrak{a}A') \).
\end{lemma}
\begin{proof}
  如果 \( b \in B \) 在 \( \mathfrak{a} \) 上整. 我们知道 \( b \in A' \) 且 \(
  b^n \in \mathfrak{a} A' \), 因此 \( b \in \operatorname{rad}(\mathfrak{a}A')
  \).

  反过来, 如果 \( b \in \operatorname{rad}(\mathfrak{a} A') \), 使得
  \[
    b^m = \sum_i a_i x_i,\quad \text{其中} m > 0,\quad a_i \in
    \mathfrak{a},\quad x_i \in A'.
  \]
  因为 \( x_i \) 在 \( A \) 整, 考虑 \( M = A[x_1, \ldots, x_n] \)
  是一个有限生成代数. 因为 \( b^m M \subseteq \mathfrak{a} M \), 我们知道 \( b^m
  \) 在 \( \mathfrak{a} \) 上整, 因此 \( b \) 在 \( \mathfrak{a} \) 上整.
\end{proof}

\begin{proposition}
  假设 \( A \) 是一个整闭整环, \( E \) 是 \( A \) 的分式域的扩张, \( \alpha \in
  E \).
  如果  \( \alpha \) 在 \( A \) 的理想 \( \mathfrak{a} \) 上整,
  那么 \( \alpha \) 在 \( F \) 的极小多项式系数都在 \(
  \operatorname{rad}(\mathfrak{a}) \) 上.
\end{proposition}
\begin{proof}
  %TODO: 域论
  % 假设 \( \alpha \) 在 \( \mathfrak{a} \) 上整, 使得
  % \[
  %   \alpha^n + a_1 \alpha^{n - 1} + \cdots + a_n = 0,\quad n > 0,\quad a_i \in
  %   \mathfrak{a}.
  % \]
\end{proof}

\begin{theorem}
  假设 \( A \subseteq B \) 为整环, 且 \( A \) 整闭, \( B \) 在 \( A \) 上整.
  如果 \( \mathfrak{p} \supseteq \mathfrak{p}' \) 为 \( A \) 的素理想, \(
  \mathfrak{q} \) 为 \( B \) 的素理想使得 \( \mathfrak{q} \cap A = \mathfrak{p}
  \). 那么 \( \mathfrak{q} \) 包含一个 \( B \) 的素理想 \( \mathfrak{q}' \) 使得
  \( \mathfrak{q}' \cap A = \mathfrak{p}' \).
  % https://q.uiver.app/#q=WzAsNixbMCwwLCJCIl0sWzAsMSwiQSJdLFsxLDAsIlxcbWF0aGZyYWt7cX0iXSxbMSwxLCJcXG1hdGhmcmFre3B9Il0sWzIsMCwiXFxtYXRoZnJha3txfSciXSxbMiwxLCJcXG1hdGhmcmFre3B9JyJdLFszLDUsIlxcc3Vwc2V0IiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzIsNCwiXFxzdXBzZXQiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMywyLCIiLDEseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzUsNCwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSwwLCIiLDEseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
  \[\begin{tikzcd}
    B & {\mathfrak{q}} & {\mathfrak{q}'} \\
    A & {\mathfrak{p}} & {\mathfrak{p}'}
    \arrow["\supset"{description}, draw=none, from=1-2, to=1-3]
    \arrow[no head, from=2-1, to=1-1]
    \arrow[no head, from=2-2, to=1-2]
    \arrow["\supset"{description}, draw=none, from=2-2, to=2-3]
    \arrow[dashed, no head, from=2-3, to=1-3]
  \end{tikzcd}\]
\end{theorem}
\begin{proof}
  \( B \) 的包含在 \( \mathfrak{q} \) 的素理想与 \( B_{\mathfrak{q}} \)
  的素理想一一对应, 因此我们只需要证明 \( \mathfrak{p}' \) 为 \(
  B_{\mathfrak{q}} \) 的一个素理想的收缩, 或者由
  \cref{proposition-integral-iff-condition} 等价地,
  \[
    A \cap \mathfrak{p}' B_{\mathfrak{q}} = \mathfrak{p}'
  \]
  如果 \( b \in \mathfrak{p}' B_{\mathfrak{q}} \), 那么 \( b = y/s \), 其中 \( y
  \in \mathfrak{p}'B, s \in B \setminus \mathfrak{q} \). \( y \) 在 \(
  \mathfrak{p}' \) 整, 满足
  \[
    y^m + a_1 y^{m - 1} + \cdots + a_m = 0,
  \]
  其中 \( a_i \in \operatorname{rad}(\mathfrak{p}') = \mathfrak{p}' \).

  假设 \( b \in A \cap \mathfrak{p}' B_{\mathfrak{q}} \), 那么 \( b^{-1} \in F =
  \operatorname{Frac} A \), 将上式的 \( y \) 替换为 \( bs \) 在除去 \( b^m \)
  得到
  \[
    s^m + (a_1 / b) s^{m - 1} + \cdots + (a_m / b^m) = 0.
  \]
  可以知道这对应 \( s \) 在 \( F \) 的极小多项式, 结合 \( s \) 在 \( A \) 中整,
  知道 \( a_i / b^i \in A \). 假设 \( b \notin \mathfrak{p}' \), 系数 \( a_i /
  b^i \in \mathfrak{p}' \)(否则 \( a_i \notin \mathfrak{p}' \)), 因而 \( s^m \in
  \mathfrak{p}' B \subseteq \mathfrak{p} B \subseteq \mathfrak{q} \), 因此 \( s
  \in \mathfrak{q} \), 矛盾. 因此 \( b \in \mathfrak{p}' \), 换句话说 \( A \cap
  \mathfrak{p}' B_{\mathfrak{q}}= \mathfrak{p}' \).
\end{proof}

\begin{corollary}
  假设 \( A \subseteq B \) 为整环, \( A \) 整闭且 \( B \) 在 \( A \) 上整. 如果
  \( \mathfrak{p}_1 \supseteq \cdots \supseteq \mathfrak{p}_n \) 为 \( A \)
  的素理想, 且令
  \[
    \mathfrak{q}_1 \supseteq \cdots \supseteq \mathfrak{q}_m \quad (m < n)
  \]
  为 \( B \) 的素理想使得对所有 \( i \) 都有 \( \mathfrak{q}_i \cap A =
  \mathfrak{p}_i \), 那么存在素理想链扩张
  \[
    \mathfrak{q}_1 \supseteq \cdots \supseteq \mathfrak{q}_n
  \]
  使得 \( \mathfrak{q}_i \cap A = \mathfrak{p} \) 对所有 \( i \) 成立.
\end{corollary}


\section{Krull 维数}

假设 \( A \) 是一个环.
\begin{enumerate}
  \item 给定 \( A \) 的一个素理想 \( \mathfrak{p} \).
    \( \mathfrak{p} \)
    的\emph{高度 \( \operatorname{ht}(\mathfrak{p}) \)} 定义为

    \[
      \sup \left\lbrace d: \mathfrak{p} = \mathfrak{p}_d \supsetneq
      \mathfrak{p}_{d - 1} \supsetneq \cdots \supsetneq \mathfrak{p}_0,
    \mathfrak{p}_i \text{为素理想} \right\rbrace
    \]
  \item \( A \) 的 \emph{Krull 维数} 定义为
    \[
      \sup \left\lbrace \operatorname{ht}(\mathfrak{p}): \mathfrak{p} \subseteq
      A, \text{其中} \mathfrak{p} \text{素} \right\rbrace.
    \]
\end{enumerate}

\begin{remark}
如果 \( A \) 是一个整环, 那么
\[
  \operatorname{dim} (A) = 0 \iff (0) \text{极大} \iff A \text{是一个域}.
\]
\end{remark}

\section{平坦性}
\begin{proposition}
  如果 \( M \) 是一个 \( A \)-模, \( 0 \to N' \xrightarrow{\alpha} N
  \xrightarrow{\beta} N'' \to 0 \) 是一个正合的 \( A \)-模列, 那么列
  \[
    M \otimes_A N' \xrightarrow{1 \otimes \alpha} M \otimes_A N \xrightarrow{1
    \otimes \beta} M \otimes_A N'' \to 0
  \]
  正合.
\end{proposition}
\begin{proof}
  %TODO: 证明
\end{proof}

\subsection{平坦与忠实平坦}

\begin{example}
  单射 \( N \to N' \) 诱导的映射 \( M \otimes_A N' \to M \otimes_A N \)
  \textbf{未必}是单射. 考虑正合列
  \[
    0 \to \mathbb{Z} \xrightarrow{\times m} \mathbb{Z} \to \mathbb{Z} / m
    \mathbb{Z} \to 0.
  \]
  函子 \( \bullet \otimes_{\mathbb{Z}} \mathbb{Z} / m \mathbb{Z} \) 下
  \( \mathbb{Z} / m \mathbb{Z} \xrightarrow{x \mapsto mx = 0} \mathbb{Z} / m
  \mathbb{Z} \) 为零态射, 并非单射.
\end{example}

\begin{example}
  \( M \) 和 \( N \) 均非零时, \( M \otimes_A N \) \textbf{未必} 非零. 例如
  \[
    \mathbb{Z} / 2 \mathbb{Z} \otimes_{\mathbb{Z}} \mathbb{Z} / 3 \mathbb{Z} =
    0,
  \]
  因此 \( a \otimes b = (3 - 2) a \otimes b = -2a \otimes b + a \otimes 3b = 0
  \). 实际上, 更特别地, \( M = N \neq 0 \) 时 \( M \otimes_A N \) 亦有可能为零,
  例如
  \[
    \mathbb{Q} / \mathbb{Z} \otimes_{\mathbb{Z}} \mathbb{Q} / \mathbb{Z} = 0.
  \]
\end{example}

一个 \( A \)-模 \( M \) 称为
\begin{enumerate}
  \item \emph{平坦}, 如果对任意 \( A \)-模 \( N, N' \)
    \[
      N' \to N \text{单} \implies M \otimes_A N' \to M \otimes_A N \text{单}.
    \]
  \item \emph{忠实平坦}, 如果对任意 \( A \)-模 \( N \)
    \[
      M \otimes_A N = 0 \implies N = 0.
    \]
\end{enumerate}
一个环同态 \( A \to B \) 称为\emph{平坦}(resp. \emph{忠实平坦}), 如果 \( B \)
作为 \( A \)-模平坦(resp. 忠实平坦).
\begin{remark}
  假设 \( B \) 是一个平坦模, 那么函子 \( F = \bullet \otimes B \) 是正合函子.
% https://q.uiver.app/#q=WzAsMTMsWzIsMiwiQSciXSxbMywzLCJcXG9wZXJhdG9ybmFtZXtJbX1mIl0sWzEsMSwiXFxvcGVyYXRvcm5hbWV7S2VyfWYiXSxbMCwwLCIwIl0sWzQsNCwiMCJdLFsyLDQsIjAiXSxbNCwyLCJBIl0sWzYsMiwiQScnIl0sWzUsMSwiXFxvcGVyYXRvcm5hbWV7SW19IGciXSxbNiwwLCIwIl0sWzcsMywiXFxvcGVyYXRvcm5hbWV7Q29rZXJ9ZyJdLFs4LDQsIjAiXSxbNCwwLCIwIl0sWzMsMl0sWzIsMF0sWzAsMV0sWzUsMV0sWzEsNF0sWzEsNl0sWzAsNiwiZiJdLFs2LDcsImciXSxbNiw4XSxbOCw5XSxbOCw3XSxbNywxMF0sWzEwLDExXSxbMTIsOF1d
\[\begin{tikzcd}[sep=tiny]
	0 &&&& 0 && 0 \\
	& {\operatorname{Ker}f} &&&& {\operatorname{Im} g} \\
	&& {A'} && A && {A''} \\
	&&& {\operatorname{Im}f} &&&& {\operatorname{Coker}g} \\
	&& 0 && 0 &&&& 0
	\arrow[from=1-1, to=2-2]
	\arrow[from=1-5, to=2-6]
	\arrow[from=2-2, to=3-3]
	\arrow[from=2-6, to=1-7]
	\arrow[from=2-6, to=3-7]
	\arrow["f", from=3-3, to=3-5]
	\arrow[from=3-3, to=4-4]
	\arrow[from=3-5, to=2-6]
	\arrow["g", from=3-5, to=3-7]
	\arrow[from=3-7, to=4-8]
	\arrow[from=4-4, to=3-5]
	\arrow[from=4-4, to=5-5]
	\arrow[from=4-8, to=5-9]
	\arrow[from=5-3, to=4-4]
\end{tikzcd}\]
\( F \) 诱导了交换图
% https://q.uiver.app/#q=WzAsMTMsWzIsMiwiRihBJykiXSxbMywzLCJGKFxcb3BlcmF0b3JuYW1le0ltfWYpIl0sWzEsMSwiRihcXG9wZXJhdG9ybmFtZXtLZXJ9ZikiXSxbMCwwLCIwIl0sWzQsNCwiMCJdLFsyLDQsIjAiXSxbNCwyLCJGKEEpIl0sWzYsMiwiRihBJycpIl0sWzUsMSwiRihcXG9wZXJhdG9ybmFtZXtJbX0gZykiXSxbNiwwLCIwIl0sWzcsMywiRihcXG9wZXJhdG9ybmFtZXtDb2tlcn1nKSJdLFs4LDQsIjAiXSxbNCwwLCIwIl0sWzMsMl0sWzIsMF0sWzAsMV0sWzUsMV0sWzEsNF0sWzEsNl0sWzAsNiwiRihmKSJdLFs2LDcsIkYoZykiXSxbNiw4XSxbOCw5XSxbOCw3XSxbNywxMF0sWzEwLDExXSxbMTIsOF1d
\[\begin{tikzcd}[sep=tiny]
	0 &&&& 0 && 0 \\
	& {F(\operatorname{Ker}f)} &&&& {F(\operatorname{Im} g)} \\
	&& {F(A')} && {F(A)} && {F(A'')} \\
	&&& {F(\operatorname{Im}f)} &&&& {F(\operatorname{Coker}g)} \\
	&& 0 && 0 &&&& 0
	\arrow[from=1-1, to=2-2]
	\arrow[from=1-5, to=2-6]
	\arrow[from=2-2, to=3-3]
	\arrow[from=2-6, to=1-7]
	\arrow[from=2-6, to=3-7]
	\arrow["{F(f)}", from=3-3, to=3-5]
	\arrow[from=3-3, to=4-4]
	\arrow[from=3-5, to=2-6]
	\arrow["{F(g)}", from=3-5, to=3-7]
	\arrow[from=3-7, to=4-8]
	\arrow[from=4-4, to=3-5]
	\arrow[from=4-4, to=5-5]
	\arrow[from=4-8, to=5-9]
	\arrow[from=5-3, to=4-4]
\end{tikzcd}\]
其中斜对角链都是正合的, 由交换性
\begin{align*}
  \operatorname{Im}F(f) &= \operatorname{Im} (F(A') \to F(\operatorname{Im}f) \to
  F(A))\\ &= \operatorname{Im} (F(\operatorname{Im}f) \to F(A)) \\ &=
  \operatorname{Ker} (F(A) \to F(\operatorname{Im}g)) \\ &=
  \operatorname{Ker}(F(A) \to F(\operatorname{Im}g) \to F(A'')) \\ &=
  \operatorname{Ker}F(g)
\end{align*}
第二个等号是因为 \( F(A') \to F(\operatorname{Im}f) \) 是满射, 第四个等号是因为
\( F(\operatorname{Im}g) \to F(A'') \) 是单射.
\end{remark}

\begin{proposition}
  假设 \( P \) 为忠实平坦 \( A \)-模. 那么 \( A \)-模链复形
  \[
    (N): \quad N' \xrightarrow{\alpha} N \xrightarrow{\beta} N''
  \]
  正合当且仅当
  \[
    P \otimes_A (N): \quad P \otimes_A N' \xrightarrow{1 \otimes \alpha} P
    \otimes_A N \xrightarrow{1 \otimes \beta} P \otimes_A N''
  \]
  正合.

  反过来, 如果
  \[
    (N) \text{正合} \iff P \otimes_A (N) \text{正合}
  \]
  那么 \( P \) 是一个忠实平坦 \( A \)-模.
\end{proposition}
\begin{proof}
  记 \( C = \operatorname{Ker} \beta / \operatorname{Im} \alpha \), 考虑正合列
  \[
    N' \xrightarrow{\alpha} \operatorname{Ker} (\beta) \to C \to 0
  \]
  如果 \( P \) 平坦, 可以验证 \( P \otimes_A \operatorname{Ker}\beta \simeq
  \operatorname{Ker}(1 \otimes \beta) \), 那么复形链
  \[
    P \otimes_A N' \xrightarrow{1 \otimes \alpha} \operatorname{Ker} (1 \otimes
    \beta) \to P \otimes_A C \to 0
  \]
  正合. 那么
  \[
    (N) \text{正合} \iff C = 0 \iff P \otimes_A C = 0 \iff P \otimes_A (N)
    \text{正合}.
  \]
\end{proof}

\begin{corollary}
  假设 \( A \to B \) 忠实平坦. 如果 \( M \otimes_A B \) 作为 \( B \)-模平坦
  (resp. 忠实平坦), 那么 \( A \)-模 \( M \) 平坦 (resp. 忠实平坦).
\end{corollary}
\begin{proof}
  考虑复形链 \( (N): N' \to N \to N'' \). 如果 \( M \otimes_A B \) 平坦, 那么
  \[
    (N) \text{正合} \iff B \otimes_A (N) \text{正合} \implies ((N) \otimes_A B)
    \otimes_B (M \otimes_A B) \text{正合},
  \]
  其中 \( ((N) \otimes_A B) \otimes_{B} (M \otimes_A B) \simeq ((N) \otimes_A
  M)\otimes_A B  \), 其正合当且仅当 \( (N) \otimes_A M \) 正合. 因此 \( M \)
  平坦. 如果 \( B \otimes_A M \) 忠实平坦, 那么 \( (N) \) 正合当且仅当 \( B
  \otimes_A M \) 正合, 从而 \( M \) 忠实平坦.
\end{proof}

\begin{corollary}
  假设 \( A \to B \) 忠实平坦, \( M \) 为 \( A \)-模. 如果 \( B \)-模 \( B
  \otimes_A M \) 有限生成, 那么 \( M \) 有限生成.
\end{corollary}
\begin{proof}
  假设 \( 1 \otimes m_1, \ldots, 1 \otimes m_r \) 生成 \( B \otimes_A M \), 记
  \( N \) 为由 \( m_i \) 生成的 \( M \)-子模. 那么正合列 \( N \to M \to M / N
  \to 0 \) 在张量 \( B \) 后保持正合. 而 \( B \otimes M / N = 0 \), 结合 \( B \)
  忠实平坦, 得到 \( M / N = 0 \).
\end{proof}

\begin{proposition}
  假设 \( i: A \to B \) 为忠实平坦同态. 对每个 \( A \)-模 \( M \), 列
  \[
    0 \to M \xrightarrow{d_0} B \otimes_A M \xrightarrow{d_1} B \otimes_A B
    \otimes_A M
  \]
  其中
  \[
    \begin{cases}
    d_0(m) = 1 \otimes m\\
    d_1(b \otimes m) = 1 \otimes b \otimes m - b \otimes 1 \otimes m
    \end{cases}
  \]
  正合.
\end{proposition}
\begin{proof}
  假设存在 \( i \) 的截面 \( f: B \to A \) 使得 \( f \circ i =
  \operatorname{id}_{A} \), 定义
  \begin{align*}
    &k_0: B \otimes_A M \to M,\quad k_0(b \otimes m) = f(b) m\\ &k_1: B
    \otimes_A B \otimes_A M \to B \otimes_A M,\quad k_1(b \otimes b' \otimes m)
    = f(b)b' \otimes m.
  \end{align*}
  那么 \( k_0 d_0 = \operatorname{id}_M \), 因此 \( d_0 \) 单. 此外,
  \[
    k_1 \circ d_1 + d_0 \circ k_0 = \operatorname{id}_{B \otimes_A M}
  \]
  这说明, 如果 \( d_1(x) = 0 \), 那么 \( x = d_0(k_0 (x)) \).

  一般地, 因为 \( A \to B \) 忠实平坦, 只需要证明欲证列张量 \( B \) 后是正合的,
  也就是
  \[
    0 \to B \otimes_A M \xrightarrow{1 \otimes d_0} B \otimes_A B \otimes_A M
    \xrightarrow{1 \otimes d_1} B \otimes_A B \otimes_A B \otimes_A M
  \]
  但 \( 1 \otimes d_0 \) 截面是容易构造的:
  \[
    f: B \otimes_A B \otimes_A M \to B \otimes_A M, b \otimes_A b' \otimes_A m
    \mapsto (bb') \otimes_A m.
  \]
\end{proof}

\begin{corollary}
  如果 \( A \to B \) 忠实平坦, 那么这个态射是单射, 且其像集为下面映射一致的元素.
  \[
    \begin{cases}
    b \mapsto 1 \otimes b\\
    b \mapsto b \otimes 1
    \end{cases}:\quad B \to B \otimes_A B.
  \]
\end{corollary}
\begin{proof}
  取 \( M = A \).
\end{proof}

\begin{proposition}
  \label{proposition-faithfully-flat-TFAE-conditions}
  假设 \( \varphi: A \to B \) 平坦, 那么以下条件等价:
  \begin{enumerate}
    \item \( \varphi \) 忠实平坦.
    \item 对每个 \( A \) 的极大理想 \( \mathfrak{m} \), 理想 \(
      \varphi(\mathfrak{m})B \neq B \).
    \item 每个 \( A \) 的极大理想 \( \mathfrak{m} \) 都是某个 \( B \)
      的极大理想的逆像 \( \varphi^{-1}(\mathfrak{n}) \).
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) \( \implies \) (2) 假设 \( \mathfrak{m} \) 为 \( A \) 的一个极大理想,
  那么由忠实平坦性,
  \[
    0 \neq B \otimes_A A/ \mathfrak{m} \simeq B/\varphi(\mathfrak{m})B.
  \]

  (2) \( \implies \) (3) \( \mathfrak{m}^e \neq B \) 说明 \( \mathfrak{m}^e \)
  包含在一个极大理想 \( \mathfrak{n} \) 中, 于是由 \( \mathfrak{m} \) 的极大性
  \( \mathfrak{n}^c = \mathfrak{m} \).

  (3) \( \implies \) (1) 假设 \( M \) 是一个非零 \( A \)-模, 下面证明 \( B
  \otimes_A M \neq 0 \).
  设 \( x \in M \) 为非零元, 那么 \( Ax \) 为 \( M \) 的一个子模, 且有 \(  Ax
  \simeq A / \operatorname{ann} (x) \).
  再设 \( \mathfrak{m} \) 是包含 \( \operatorname{ann} (x) \) 的一个极大理想,
  那么由(3) 存在 \( B \) 的极大理想 \( \mathfrak{n} \) 使得 \(
  \varphi^{-1}(\mathfrak{n}) = \mathfrak{m} \).
  由于 \( \varphi \) 平坦, \( B \otimes_A Ax \simeq B/\varphi(\mathfrak{m})B \)
  可视为 \( B \otimes_A M \) 子模, 而 \( \varphi(\mathfrak{a})B \subset
  \varphi(\mathfrak{m})B \subset \mathfrak{n} \) 也就是 \( B \otimes_A Ax \neq 0
  \), 故 \( B \otimes_A M \neq 0 \).
\end{proof}

\begin{proposition}
  \label{proposition-faithfully-flat-homomorphism-induce-surjective-spectrum-morphism}
  假设 \( \varphi: A \to B \) 是一个忠实平坦同态, 那么 \( {}^a \varphi:
  \operatorname{Spec} B \to \operatorname{Spec} A \) 是满射.
\end{proposition}
\begin{proof}
  对任意 \( \mathfrak{p} \in \operatorname{Spec} A \), \( B \otimes_A
  \kappa(\mathfrak{p}) \neq 0 \).
\end{proof}

\begin{proposition}
  假设 \( A \to B \) 是一个平坦同态, \( \mathfrak{p}', \mathfrak{p} \) 为 \( A
  \) 中的素理想, \( \mathfrak{q} \) 为 \( B \) 中的素理想, 使得 \( \mathfrak{p}'
  \subset \mathfrak{p}, \mathfrak{q}^c = \mathfrak{p} \), 那么存在 \( B \)
  中的素理想 \( \mathfrak{q}' \) 使得 \( \mathfrak{q}' \subset \mathfrak{q},
  \mathfrak{q}'^c = \mathfrak{p}' \).
\end{proposition}
\begin{proof}
  由 \( A \to B \) 平坦性, 可以知道 \( A_{\mathfrak{p}} \to B_{\mathfrak{q}} \)
  的平坦性.
  \( A_{\mathfrak{p}} \) 极大理想只有 \( \mathfrak{p} A_{\mathfrak{p}} \), 而 \(
  (\mathfrak{q} B_{\mathfrak{q}})^c = \mathfrak{p} A_{\mathfrak{p}} \),
  由\cref{proposition-faithfully-flat-TFAE-conditions} 知道 \( A_{\mathfrak{p}}
  \to B_{\mathfrak{q}} \) 忠实平坦.
  由\cref{proposition-faithfully-flat-homomorphism-induce-surjective-spectrum-morphism},
  存在 \( (\mathfrak{q}'B_{\mathfrak{q}})^c = \mathfrak{p}' A_{\mathfrak{p}} \),
  于是 \( \mathfrak{q}'^c = \mathfrak{p}' \).
\end{proof}
